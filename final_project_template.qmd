---
title: "Genetic and Environmental Factors Shaping Height and Weight: A Study of Twins and Adoption"
subtitle: "BMIN503/EPID600 Final Project"
author: "ZI WANG"
format: html
editor: visual
number-sections: true
embed-resources: true
---

------------------------------------------------------------------------

## Overview {#sec-overview}

Studying both biological and virtual twins can provide comprehensive insights into the influences of genetics and environment. Biological twins help emphasize the impact of genetic factors, whereas virtual twins highlight the role of shared early-life environmental factors. The main objective of this twin study is to distinguish the contribution of nature in influencing height and weight, as opposed to nurture."

## Introduction {#sec-introduction}

There is no doubt that genetic and environmental factors significantly impact early childhood growth and development. Complex interactions and correlations exist among genetic, prenatal environmental, and postnatal environmental influences, leading to a range of health-related outcomes. However, much debate has concerned the dominant influence of nature or nurture. Twin and adoption studies have been widely employed by researchers to assess differences within study pairs and estimate the contributions of genetic and environmental factors to various traits and behaviors. In this study, we aim to evaluate whether genetics or the shared environment significantly influences the variations in height and weight among pairs of twins, siblings, and adoptees.

When we dive into the study of height and weight in twins and adoptees, genes certainly lay the groundwork, but where and how a child is raised also play a crucial role of their early growth and development. This complex question requires insights from various fields. 
In the scientific area, geneticists start searching for the specific genes that affect height and weight the most. Meanwhile, nutrition experts bring in their expertise to exploring how their diets shape these physical characteristics. Epidemiologists shift their concerns to figure out how common certain height and weight traits are and what factors are more likely to contribute to these differences, while biostatisticians step into analyzing datasets and quantifying the relative contributions of genetics and environment to variations in individual characteristics.
These fields will share their own piece to the puzzle to understanding the interfaces of nature and nurture in children’s early years of growth and development.

## Methods {#sec-methods}

Describe the data used and general methodological approach used to address the problem described in the @sec-introduction. Subsequently, incorporate full R code necessary to retrieve and clean data, and perform analysis. Be sure to include a description of code so that others (including your future self) can understand what you are doing and why.

Twin studies are useful to disentangle the relative importance of environmental and genetic influences on individual traits and behaviors. Two types of twins can be included in these studies: biological and virtual twins. Biological twins include monozygotic (MZ) twins and dizygotic (DZ) twins. MZ twins are developed from the same zygote and thus have the same genetic components. Dizygotic (DZ) twins are developed from two different zygotes and like any other siblings, share in average 50% of their genetic variants. Virtual twins (VTs) are two adoptees or one natural child plus one adoptee who are of the same age and are raised together since infancy. VT twins do not have much of the genes in common. All MZ, DZ and VT twins share many aspects of their environment. Thus, MZ twins are almost always more similar than DZ twins due to higher genetic similarity coupled with the same amount of environmental similarity, while DZ twins share more similarity than VT twins. By comparing the similarity of MZ, DZ, and VT twins, we can decompose the roles of genetic and environmental factors on traits of interest.
The goal of this twin study was to understand whether the genetic or environmental factors influence height and weight more. The data “twin.txt” included 1098 individuals from 164 monozygotic (MZ) twin pairs, 156 dizygotic (DZ) twin pairs, 132 virtual twin (VT) pairs.

### 1. Data Preparation
#### 1.1 Load the necessary R packages:

```{r}
library(dplyr)
library(epiDisplay)
library(tidyverse)
library(ggplot2)
library(vtable)

# Function for corr test & plot
corrplot2 <- function(data,
                      method = "pearson",
                      sig.level = 0.05,
                      order = "original",
                      diag = FALSE,
                      type = "upper",
                      tl.srt = 90,
                      number.font = 1,
                      number.cex = 1,
                      mar = c(0, 0, 0, 0)) {
  library(corrplot)
  data_incomplete <- data
  data <- data[complete.cases(data), ]
  mat <- cor(data, method = method)
  cor.mtest <- function(mat, method) {
    mat <- as.matrix(mat)
    n <- ncol(mat)
    p.mat <- matrix(NA, n, n)
    diag(p.mat) <- 0
    for (i in 1:(n - 1)) {
      for (j in (i + 1):n) {
        tmp <- cor.test(mat[, i], mat[, j], method = method)
        p.mat[i, j] <- p.mat[j, i] <- tmp$p.value
      }
    }
    colnames(p.mat) <- rownames(p.mat) <- colnames(mat)
    p.mat
  }
  p.mat <- cor.mtest(data, method = method)
  col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))
  corrplot(mat,
           method = "color", col = col(200), number.font = number.font,
           mar = mar, number.cex = number.cex,
           type = type, order = order,
           addCoef.col = "black", # add correlation coefficient
           tl.col = "black", tl.srt = tl.srt, # rotation of text labels
           # combine with significance level
           p.mat = p.mat, sig.level = sig.level, insig = "blank",
           # hide correlation coefficients on the diagonal
           diag = diag
  )
}

```

#### 1.2 Load and explore the dataset:
```{r}
## read in dataset
#list.files("/Users/ziwang89/dropbox/penn_phd/BMIN503:EPID600_2023FALL/final project/")
Twin_dat <- read.table("/Users/ziwang89/dropbox/penn_phd/BMIN503:EPID600_2023FALL/final project/Data_Twin_Study.txt", header = T, sep = "")
View(Twin_dat)

#check the dim of the twin data set
dim(Twin_dat)

#list the length of unique twin pairs based on ID number (IDNO)
length(unique(Twin_dat$IDNO))

#check whether there exists pairs of triple twins babies or cases of mislabeling
Twin_dat %>% count(IDNO) %>% filter( n != 2 )
```

### 2. Descriptive Analysis
#### 2.1 Descriptive statistics:
```{r}
## to change data type based on given variables 
names(Twin_dat)
Twin_dat <- Twin_dat %>% mutate(across(c(2,3,4,10), as.factor))

## to generate a descriptive statistics table of the twins dataset
sumtable(Twin_dat,
         summ=c('notNA(x)',
                'mean(x)',
                'median(x)',
                'pctile(x)[25]', 'pctile(x)[75]',
                'propNA(x)'))
```

#### 2.2 Data visualization:
##### for categorical variables

According to the Data Dictionary,
2. **BO** (Birth Order): 1=child 1 2=child 2 (done in alphabetical order of first name); however, for VTS, younger child is always child 1

3. **Zyg** (Zygosity): 1=MZ 2=DZ 3=VT (2 adoptees) 4=VT (1 adoptee, 1 biological child) 5=Full sibs

4. **Sex** 1 = Female, 2 = Male

9. **Race** 1=African-American, 2=American Indian/Alaska Native 3=Asian 4=Native Hawaiian/pacific Islander 5=White 6=Hispanic 7=South American Indian 8 = Mixed 9 = Other 0 = Missing

First of all, let explore the distribution for each Zygosity subgroup
```{r}
# Grouped
ggplot(Twin_dat, aes(fill=Sex, y=Sex, x=Zyg)) + 
    #geom_bar(position="stack", stat="identity") +
    geom_bar(aes( y=..count../tapply(..count.., ..x.. ,sum)[..x..]), position="dodge" ) +
    geom_text(aes( y=..count../tapply(..count.., ..x.. ,sum)[..x..], label=scales::percent(..count../tapply(..count.., ..x.. ,sum)[..x..]) ),
            stat="count", position=position_dodge(0.9), vjust=-0.5)+
    ylab('Percent of Gender Group, %') +
    scale_y_continuous(labels = scales::percent) +
    theme_classic()



```


5. **Agemon** (Age in Months)

6. **Ht1** (Height of child 1 in inches) Missing Values = 99.99

7. **Wt1** (Weight of child 1 in pounds Missing Values = 999.99

8. **Ht2** (Height of child 2 in inches) Missing Values = 99.99

9. **Wt2** (Weight of child2 in pounds Missing Values = 999.99


```{r}
# Normal curve
fun <- dnorm(dat, mean = mean(dat), sd = sd(dat))
max(fun)

par(mfrow = c(1, 1))
# Histogram
hist(dat, probability = TRUE, xlab = expression("X"[1]*""), col = "grey", #ylim = c(0, max(fun)+0.01),
     axes = FALSE, 
     main =  expression("Contaminated Normal Distribution of X"[1]*"(n=24)"))
# Axis
axis(1)
# Density
lines(density(dat), col = "red", lwd = 2)
# Add boxplot
par(new =TRUE)
boxplot(dat, horizontal = TRUE, 
        axes = FALSE, 
        ylim = c(-20,65),
        #boxlwd = 1, outwex = 0.5, boxwex = 0.2,
        lwd = 2, col = rgb(0, 1, 1, alpha = 0.15)
)
stripchart(dat,              # Data
           method = "jitter", # Random noise
           pch = 18,          # Pch symbols
           col = 4,           # Color of the symbol
           # vertical = TRUE,   # Vertical mode
           add = TRUE) 


```


## Results {#sec-results}

Describe your results and include relevant tables, plots, and code/comments used to obtain them. You may refer to the @sec-methods as needed. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.

## Conclusion

This the conclusion. The @sec-results can be invoked if you'd like.
